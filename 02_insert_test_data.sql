-- Файл: sql/02_insert_test_data.sql
-- Наполнение базы данных тестовыми данными
-- День 3: DML-операции

USE cnbp_production_db;

-- =====================================================
-- 1. Заполнение таблицы Projects
-- =====================================================
INSERT INTO Projects (project_name, client_name, start_date, deadline, status) VALUES
('Заказ №245 - Вал-шестерня', 'ООО "Проммаш"', '2025-01-15', '2025-02-28', 'В работе'),
('Заказ №246 - Корпус редуктора', 'АО "Механический завод"', '2025-02-01', '2025-03-30', 'В планировании'),
('Заказ №247 - Оси транспортёра', 'ООО "КонвейерСтрой"', '2025-02-10', '2025-03-15', 'В работе'),
('Заказ №248 - Фланцы', 'ИП Сидоров', '2025-02-20', '2025-03-10', 'Завершён');

-- =====================================================
-- 2. Заполнение таблицы Products
-- =====================================================
INSERT INTO Products (product_name, drawing_number, specification, project_id) VALUES
('Вал-шестерня', 'ВШ-01-245', 'Сталь 40Х, цементация, HRC 58-62', 1),
('Вал-шестерня (черновая)', 'ВШ-01-245-черн', 'Заготовка под чистовую обработку', 1),
('Корпус редуктора', 'КР-02-246', 'Чугун СЧ20, механическая обработка', 2),
('Крышка редуктора', 'КР-03-246', 'Сталь 3, окраска', 2),
('Ось транспортёра', 'ОТ-01-247', 'Сталь 45, термообработка', 3),
('Фланец DN50', 'ФЛ-01-248', 'Сталь 20, оцинковка', 4),
('Фланец DN80', 'ФЛ-02-248', 'Сталь 20, оцинковка', 4);

-- =====================================================
-- 3. Заполнение таблицы Operations
-- =====================================================
INSERT INTO Operations (operation_name, operation_code, standard_time, required_qualification, description) VALUES
('Токарная обработка черновая', 'ТК-01', 1.5, 'Токарь 3 разряда', 'Обточка заготовки, сверление центровых отверстий'),
('Токарная обработка чистовая', 'ТК-02', 2.0, 'Токарь 5 разряда', 'Чистовая обработка до чертежных размеров'),
('Фрезерование шпоночных пазов', 'ФР-01', 1.0, 'Фрезеровщик 4 разряда', 'Фрезерование пазов под шпонку'),
('Сверлильная операция', 'СВ-01', 0.5, 'Сверловщик 3 разряда', 'Сверление отверстий по разметке'),
('Термообработка', 'ТО-01', 4.0, 'Термист 5 разряда', 'Закалка, отпуск'),
('Контроль качества', 'КК-01', 0.5, 'Контролёр ОТК', 'Проверка размеров, твёрдости'),
('Сборка', 'СБ-01', 2.0, 'Слесарь-сборщик 4 разряда', 'Сборка узлов'),
('Окраска', 'ОК-01', 1.5, 'Маляр', 'Грунтовка, покраска');

-- =====================================================
-- 4. Заполнение таблицы Machines
-- =====================================================
INSERT INTO Machines (machine_name, inventory_number, manufacture_year, machine_type, status, last_maintenance) VALUES
('Токарный станок 1К62', 'Т-001', 2015, 'Токарно-винторезный', 'Исправен', '2025-01-20'),
('Токарный станок 16К20', 'Т-002', 2018, 'Токарно-винторезный', 'Исправен', '2025-02-05'),
('Фрезерный станок 6Р13', 'Ф-001', 2016, 'Вертикально-фрезерный', 'Ремонт', '2024-12-10'),
('Сверлильный станок 2Н135', 'С-001', 2014, 'Вертикально-сверлильный', 'Исправен', '2025-01-15'),
('Термическая печь', 'П-001', 2010, 'Камерная', 'Исправен', '2025-02-01'),
('Координатно-измерительная машина', 'КИМ-01', 2020, 'Измерительная', 'Исправен', '2025-01-10');

-- =====================================================
-- 5. Заполнение таблицы Employees
-- =====================================================
INSERT INTO Employees (full_name, position, qualification, hire_date, department, email, phone) VALUES
('Иванов Александр Сергеевич', 'Токарь', '5 разряд', '2018-05-12', 'Механический цех', 'ivanov@cnbp.ru', '+7(900)123-45-67'),
('Петров Виктор Михайлович', 'Токарь', '3 разряд', '2020-09-23', 'Механический цех', 'petrov@cnbp.ru', '+7(900)234-56-78'),
('Сидорова Елена Владимировна', 'Фрезеровщик', '4 разряд', '2019-03-11', 'Механический цех', 'sidorova@cnbp.ru', '+7(900)345-67-89'),
('Кузнецов Дмитрий Алексеевич', 'Термист', '5 разряд', '2016-11-05', 'Термический цех', 'kuznetsov@cnbp.ru', '+7(900)456-78-90'),
('Морозова Татьяна Ивановна', 'Контролёр ОТК', '6 разряд', '2017-07-19', 'ОТК', 'morozova@cnbp.ru', '+7(900)567-89-01'),
('Смирнов Павел Андреевич', 'Слесарь-сборщик', '4 разряд', '2021-01-25', 'Сборочный цех', 'smirnov@cnbp.ru', '+7(900)678-90-12'),
('Васильева Анна Петровна', 'Маляр', '3 разряд', '2022-02-14', 'Окрасочный участок', 'vasilieva@cnbp.ru', '+7(900)789-01-23'),
('Николаев Игорь Владимирович', 'Мастер цеха', '6 разряд', '2015-08-30', 'Механический цех', 'nikolaev@cnbp.ru', '+7(900)890-12-34');

-- =====================================================
-- 6. Заполнение таблицы Materials
-- =====================================================
INSERT INTO Materials (material_name, material_type, unit_of_measure, unit_price, current_stock, min_stock_level) VALUES
('Сталь 40Х', 'Прокат', 'кг', 120.00, 1500.00, 500.00),
('Сталь 45', 'Прокат', 'кг', 100.00, 2000.00, 600.00),
('Сталь 20', 'Прокат', 'кг', 80.00, 1800.00, 500.00),
('Чугун СЧ20', 'Литьё', 'кг', 90.00, 800.00, 300.00),
('Краска эмаль', 'ЛКМ', 'л', 350.00, 120.00, 50.00),
('Грунтовка', 'ЛКМ', 'л', 280.00, 80.00, 30.00),
('Подшипник 306', 'Комплектующее', 'шт', 450.00, 200.00, 50.00),
('Масло индустриальное', 'Смазка', 'л', 180.00, 300.00, 100.00),
('Электроды', 'Расходные материалы', 'кг', 200.00, 500.00, 200.00);

-- =====================================================
-- 7. Заполнение таблицы Product_Materials (нормы расхода)
-- =====================================================
INSERT INTO Product_Materials (product_id, material_id, quantity_required) VALUES
-- Вал-шестерня (1) из Стали 40Х (1)
(1, 1, 3.5),
-- Вал-шестерня черновая (2) из Стали 40Х (1)
(2, 1, 4.0),
-- Корпус редуктора (3) из Чугуна (4)
(3, 4, 12.0),
-- Крышка редуктора (4) из Стали 3 (Сталь 20) (3)
(4, 3, 2.5),
-- Ось транспортёра (5) из Стали 45 (2)
(5, 2, 2.8),
-- Фланец DN50 (6) из Стали 20 (3)
(6, 3, 1.2),
-- Фланец DN80 (7) из Стали 20 (3)
(7, 3, 2.0);

-- =====================================================
-- 8. Заполнение таблицы ProductionLog
-- =====================================================
-- Дата генерации: февраль 2025
INSERT INTO ProductionLog (project_id, product_id, operation_id, machine_id, employee_id, material_id, start_time, end_time, quantity_produced, defects_count, notes) VALUES
-- 10 февраля
(1, 1, 1, 1, 1, 1, '2025-02-10 08:00:00', '2025-02-10 10:30:00', 5, 0, 'Заготовки обработаны черновой токарной'),
(1, 1, 2, 2, 2, 1, '2025-02-10 11:00:00', '2025-02-10 14:00:00', 4, 1, 'Одна деталь с браком по диаметру'),
(1, 1, 3, 3, 3, NULL, '2025-02-10 14:30:00', '2025-02-10 15:30:00', 4, 0, 'Фрезерование пазов'),
(3, 5, 1, 1, 1, 2, '2025-02-10 08:30:00', '2025-02-10 11:00:00', 8, 0, 'Обработка осей'),
(3, 5, 5, 5, 4, NULL, '2025-02-10 12:00:00', '2025-02-10 16:00:00', 8, 0, 'Закалка'),
-- 11 февраля
(1, 1, 6, 6, 5, NULL, '2025-02-11 09:00:00', '2025-02-11 09:30:00', 4, 0, 'Контроль 4 годных детали'),
(2, 3, 1, 2, 2, 4, '2025-02-11 08:00:00', '2025-02-11 11:00:00', 2, 0, 'Черновая обработка корпуса'),
(2, 3, 2, 1, 1, 4, '2025-02-11 11:30:00', '2025-02-11 15:00:00', 2, 0, 'Чистовая обработка'),
(2, 4, 4, 4, 7, 3, '2025-02-11 13:00:00', '2025-02-11 14:00:00', 6, 0, 'Сверление отверстий в крышках'),
(3, 5, 2, 2, 2, 2, '2025-02-11 10:00:00', '2025-02-11 12:30:00', 6, 0, 'Чистовая токарная'),
(4, 6, 1, 1, 1, 3, '2025-02-11 08:00:00', '2025-02-11 10:00:00', 12, 1, 'Обработка фланцев'),
(4, 7, 1, 1, 1, 3, '2025-02-11 10:15:00', '2025-02-11 12:15:00', 8, 0, 'Обработка фланцев'),
-- 12 февраля
(1, 1, 8, NULL, 7, 5, '2025-02-12 09:00:00', '2025-02-12 11:00:00', 4, 0, 'Окраска валов'),
(2, 3, 7, NULL, 6, 9, '2025-02-12 08:30:00', '2025-02-12 11:00:00', 2, 0, 'Сборка редуктора'),
(2, 4, 7, NULL, 6, 9, '2025-02-12 11:30:00', '2025-02-12 13:30:00', 4, 0, 'Сборка крышек'),
(3, 5, 6, 6, 5, NULL, '2025-02-12 14:00:00', '2025-02-12 14:30:00', 14, 1, 'Контроль качества осей'),
(4, 6, 6, 6, 5, NULL, '2025-02-12 15:00:00', '2025-02-12 15:20:00', 11, 1, 'Контроль фланцев'),
(4, 7, 6, 6, 5, NULL, '2025-02-12 15:30:00', '2025-02-12 15:50:00', 8, 0, 'Контроль фланцев'),
-- 13 февраля (несколько свежих операций)
(1, 1, 8, NULL, 7, 5, '2025-02-13 08:00:00', '2025-02-13 10:00:00', 3, 0, 'Докраска'),
(2, 3, 6, 6, 5, NULL, '2025-02-13 11:00:00', '2025-02-13 11:20:00', 2, 0, 'Контроль корпуса'),
(2, 4, 6, 6, 5, NULL, '2025-02-13 11:30:00', '2025-02-13 11:45:00', 4, 0, 'Контроль крышек');

-- Проверка вставленных данных
SELECT 'Projects' AS table_name, COUNT(*) AS records FROM Projects
UNION ALL SELECT 'Products', COUNT(*) FROM Products
UNION ALL SELECT 'Operations', COUNT(*) FROM Operations
UNION ALL SELECT 'Machines', COUNT(*) FROM Machines
UNION ALL SELECT 'Employees', COUNT(*) FROM Employees
UNION ALL SELECT 'Materials', COUNT(*) FROM Materials
UNION ALL SELECT 'Product_Materials', COUNT(*) FROM Product_Materials
UNION ALL SELECT 'ProductionLog', COUNT(*) FROM ProductionLog;
